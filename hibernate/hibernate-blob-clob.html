<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hibernate Blob Clob</title>
</head>
<link rel="stylesheet" type="text/css" href="../plugin/LanEditor/LanEditor.css"/>
<link rel="stylesheet" type="text/css" href="../plugin/LanEditor/highlight/styles/idea.css">

<link href="../plugin/SyntaxHighlighter/main.css" rel='stylesheet' type='text/css'>
<link href="../plugin/SyntaxHighlighter/shCore.css" rel='stylesheet' type='text/css'>
<link href="../plugin/SyntaxHighlighter/shThemeDefault.css" rel='stylesheet' type='text/css'>
<link href="../plugin/LanEditor/main.css" rel='stylesheet' type='text/css'>

<script src="../plugin/SyntaxHighlighter/shCore-convert.js" type='text/javascript'></script>
<script src="../plugin/SyntaxHighlighter/shBrushAll.js" type='text/javascript'></script>

<script type="text/javascript" src="../plugin/LanEditor/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../plugin/autosize/autosize.bundle.js"></script>
<script type="text/javascript" src="../plugin/LanEditor/LanEditor.js"></script>

<script type="text/javascript">

    window.autosize = require("autosize");

    $(document).ready(function () {
        //初始化 @textelem:编辑区的id @showelem可以省略
        var lan = LanEditor.init({
            textelem: "editor",
            showelem: "show"
        });
        //如果初始化失败，则显示出错信息
        if(lan.status == false){
            alter(lan.message);
            return ;
        }else{
            // 默认保存LanEditor快速指南文件
            // 获取文件创建的时间
            var createTime = LanEditor.Time.GetTimestamp();
            // 文件名
            LanEditor.File.CurOpenFile.name = $(document).attr("title");
            // 创建时间
            LanEditor.File.CurOpenFile.time = createTime;
            // 保存文件
            LanEditor.File.SaveFile();
            // 渲染
            LanEditor.RenderHTML();
        }
    });
</script>
<body>
<div id="edit">
    <textarea id="editor" name="editor">

Oracle 数据库中有 ***```BLOB```*** 和 ***```CLOB```*** 类型的大对象

在 Hibernate 中大对象类型的映射

```textarea
╔══════════════════╤══════╗
║ byte[]           │ BLOB ║
╟──────────────────┼──────╢
║ java.sql.Blob    │ BLOB ║
╟──────────────────┼──────╢
║ java.lang.String │ CLOB ║
╟──────────────────┼──────╢
║ java.sql.Clob    │ CLOB ║
╚══════════════════╧══════╝
```

***```Bigobject.java```***

```java
public class Bigobject implements java.io.Serializable {

	// Fields

	private Integer id;
	// private Clob tclob; 大文本类型数据
	// private Blob tblob; 大的二进制数据类型
	private String tclob;
	private byte[] tblob;
}
```

***```Bigobject.hbm.xml```***

```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Mapping file autogenerated by MyEclipse Persistence Tools -->
<hibernate-mapping>
	<class name="com.accp.hibernate.entity.Bigobject" table="BIGOBJECT"
		schema="Y2">
		<id name="id" type="integer">
			<column name="ID" precision="6" scale="0" />
			<generator class="assigned" />
		</id>
		<!-- <property name="tclob" type="clob"> 
				<column name="TCLOB" /> 
			 </property> 
			<property name="tblob" type="blob"> 
				<column name="TBLOB" />
			</property> 
		-->
		<property name="tclob" type="string">
			<column name="TCLOB" />
		</property>
		<property name="tblob" type="byte[]">
			<column name="TBLOB" />
		</property>
		
	</class>
</hibernate-mapping>
```

函数功能：存储大对象数据

```java
/**
 * 函数功能：存储大对象数据
 * 
 * @throws IOException
 */
private static void saveBigObject() throws IOException {
    // 获取当前类的所在资源路径
    InputStream inputStream = TestBigObject.class
            .getResourceAsStream("/test.txt");
    System.out
            .println(TestBigObject.class.getResourceAsStream("/text.txt"));
    // 声明临时的字节数组，用来封装数据
    byte[] bytes = new byte[inputStream.available()];// available()
    inputStream.read(bytes); // 将数据读取到内存中
    inputStream.close();// 关闭输入流
    // 把数据写入到数据库中
    Transaction tran = null;
    Session session = HibernateUtil.currentSession();
    Bigobject bigobject = new Bigobject();
    bigobject.setId(13);
    bigobject.setTclob("大对象数据"); // 大文本
    bigobject.setTblob(bytes); // 二进制数据
    try {
        tran = session.beginTransaction();
        session.save(bigobject);
        tran.commit();
    } catch (HibernateException e) {
        e.printStackTrace();
        tran.rollback();
    } finally {
        HibernateUtil.closeSession();
    }
```

函数功能：读取大数据对象

```java
/**
 * 函数功能：读取大数据对象
 */
private static void queryBigObject() {
    Session session = HibernateUtil.currentSession();
    Bigobject bigobject = (Bigobject) session.get(Bigobject.class,
            new Integer(13));
    String tclob = bigobject.getTclob();
    System.out.println(tclob);
    if (bigobject.getTblob() != null) {
        try {
            FileOutputStream fos = new FileOutputStream("test_bak.txt");
            fos.write(bigobject.getTblob());
            fos.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    HibernateUtil.closeSession();
}
```

***```Bigobject_2.java```***

```java
import java.sql.Blob;
import java.sql.Clob;

public class Bigobject_2 implements java.io.Serializable {

	// Fields

	private Integer id;
	private Clob tclob; // 大文本类型数据
	private Blob tblob; // 大的二进制数据类型
	// private String tclob;
	// private byte[] tblob;
}
```

***```Bigobject_2.hbm.xml```***

```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Mapping file autogenerated by MyEclipse Persistence Tools -->
<hibernate-mapping>
	<class name="com.accp.hibernate.entity.Bigobject_2" table="BIGOBJECT"
		schema="Y2">
		<id name="id" type="integer">
			<column name="ID" precision="6" scale="0" />
			<generator class="assigned" />
		</id>
		 <property name="tclob" type="clob"> 
			<column name="TCLOB" /> 
		 </property> 
		 <property name="tblob" type="blob"> 
			<column name="TBLOB" />
		 </property> 
		
		<!-- 
		<property name="tclob" type="string">
			<column name="TCLOB" />
		</property>
		<property name="tblob" type="byte[]">
			<column name="TBLOB" />
		</property> 
		-->
		
	</class>
</hibernate-mapping>
```

函数功能：存储大对象数据 

```java
/**
 * 函数功能：存储大对象数据
 * 
 * @throws IOException
 */
private static void saveBigObject() {
    InputStream in = TestBigObject_2.class.getResourceAsStream("/test.txt");
    byte[] byteArray = null;
    Bigobject_2 big = new Bigobject_2();
    try {
        byteArray = new byte[in.available()];
        in.read(byteArray);
        in.close();
        Transaction tran = null;
        Session session = HibernateUtil.currentSession();
        big.setId(15);
        big.setTblob(Hibernate.createBlob(byteArray));// 依据二进制数据创建一个Blob对象
        big.setTclob(Hibernate.createClob("测试大文本"));// 依据字符串对象创建一个Clob对象
        try {
            tran = session.beginTransaction();
            session.save(big);
            tran.commit();
            System.out.println("添加成功！");
        } catch (Exception e) {
            e.printStackTrace();
            tran.rollback();
        } finally {
            HibernateUtil.closeSession();
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

函数功能：读取大数据对象

```java
/**
 * 函数功能：读取大数据对象
 */
private static void queryBigObject() {
    Session session = HibernateUtil.currentSession();
    Bigobject_2 big = (Bigobject_2) session.get(Bigobject_2.class, new Integer(15));
    //把clob对象通过字符流读入到内存中并输出
    if(big.getTclob()!=null){
        try {
            Reader reader = big.getTclob().getCharacterStream();
            char[] chArray = new char[1];
            StringBuilder builder = new StringBuilder();
            while(reader.read(chArray)!=-1){
                builder.append(new String(chArray));
            }
            System.out.println(builder.toString().trim());
            reader.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    if(big.getTblob()!=null){
        try {
            InputStream in = big.getTblob().getBinaryStream();
            FileOutputStream fos = new FileOutputStream("file_bak1.txt");
            int b = -1;
            while((b=in.read())!=-1){
                fos.write(b);
            }
            fos.close();
            in.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    HibernateUtil.closeSession();
}
```
	</textarea>
</div>

<div id="show"></div>
</body>
</html>