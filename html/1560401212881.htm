<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JavaScript addEventListener</title>
    <link rel="stylesheet" type="text/css" href="./jquery-easyui-1.3.3/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="./jquery-easyui-1.3.3/themes/icon.css">
    <script type="text/javascript" src="./jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript" src="./jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
</head>
<body class="easyui-layout">
    <div data-options="region:'north',title:'North Title',split:true" style="height:100px;"></div>
    <div data-options="region:'south',title:'South Title',split:true" style="height:100px;"></div>
    <div data-options="region:'east',title:'East',split:true" style="width:100px;"></div>
    <div data-options="region:'west',title:'West',split:true" style="width:160px;">
        <ul id="tree" class="easyui-tree"></ul>
    </div>
    <div data-options="region:'center',title:''" style="padding:5px;background:#eee;">
        <div class="easyui-tabs" fit="true" border="false" id="tabs" >
		<div title="首页" data-options="iconCls:'icon-home'">
			<div align="center" style="padding-top: 100px;"><font color="red" size="10">欢迎使用</font></div>
		</div>
	</div>
    </div>

<div id="dlg" class="easyui-dialog" style="width: 400px;height: 220px;padding: 10px 20px" 
 closed="true" buttons="#dlg-buttons" data-options="iconCls:'icon-modifyPassword'">
 <form id="fm" method="post">
 <input type="hidden" name="userId" id="userId" value="${currentUser.userId }">
 	<table cellspacing="4px;" style="text-align:right">
 		<tr>
 			<td>用户名：</td>
 			<td><input type="text" name="userName" id="userName" readonly="readonly" value="${currentUser.userName }" style="width: 200px;" /></td>
 		</tr>
 		<tr>
 			<td>原密码：</td>
 			<td><input type="password" class="easyui-validatebox" name="oldPassword" id="oldPassword" style="width: 200px;" required="true" /></td>
 		</tr>
 		<tr>
 			<td>新密码：</td>
 			<td><input type="password" class="easyui-validatebox" name="newPassword" id="newPassword" style="width: 200px;" required="true"  /></td>
 		</tr>
 		<tr>
 			<td>确认新密码：</td>
 			<td><input type="password" class="easyui-validatebox" name="newPassword2" id="newPassword2" style="width: 200px;" required="true" /></td>
 		</tr>
 	</table>
 </form>
</div>
<div id="dlg-buttons" style="text-align:center">
	<a href="javascript:updatePassword()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
	<a href="javascript:closePasswordUpdateDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
</div>

<!-- 右键菜单 -->
<div id="mm" class="easyui-menu" style="width:150px;">
	<div id="mm-tabrefresh">刷新</div>
	<div class="menu-sep"></div>
	<div id="mm-tabclose">关闭</div>
	<div id="mm-tabcloseall">全部关闭</div>
	<div id="mm-tabcloseother">除此之外全部关闭</div>
	<div class="menu-sep"></div>
	<div id="mm-tabcloseright">当前页右侧全部关闭</div>
	<div id="mm-tabcloseleft">当前页左侧全部关闭</div>
</div>

<textarea id="textarea" style="display:none;">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JavaScript addEventListener</title>
<link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/icon.css">
<script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.min.js"></script>
<script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
</head>
<body>

<table id="dg"></table>

<script>
initPagination();
function initPagination(){
	var param = {};
	var dg = $('#dg').datagrid({
	    data:{"total":754,"rows":[{"lohHouseInfoId":850,"gmtCreate":"2019-01-22T14:46:19.000+0000","gmtModified":"2019-01-26T13:33:47.000+0000","houseTitle":"alert1\\/","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-26T13:33:47.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":854,"gmtCreate":"2019-01-24T15:07:55.000+0000","gmtModified":"2019-01-24T15:09:00.000+0000","houseTitle":"1","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-24T15:09:00.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":852,"gmtCreate":"2019-01-22T14:56:26.000+0000","gmtModified":"2019-01-22T15:00:19.000+0000","houseTitle":"alert1\\/","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T15:00:19.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":851,"gmtCreate":"2019-01-22T14:55:21.000+0000","gmtModified":"2019-01-22T15:00:14.000+0000","houseTitle":"alert1/","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T15:00:14.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":853,"gmtCreate":"2019-01-22T15:00:02.000+0000","gmtModified":"2019-01-22T15:00:02.000+0000","houseTitle":"alert1/","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T15:00:02.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":849,"gmtCreate":"2019-01-22T11:53:29.000+0000","gmtModified":"2019-01-22T14:50:04.000+0000","houseTitle":"alert1\\\\\\/","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T14:50:04.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":848,"gmtCreate":"2019-01-22T03:51:36.000+0000","gmtModified":"2019-01-22T03:51:54.000+0000","houseTitle":"","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T03:51:54.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":847,"gmtCreate":"2019-01-22T03:51:14.000+0000","gmtModified":"2019-01-22T03:51:14.000+0000","houseTitle":"","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T03:51:14.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":846,"gmtCreate":"2019-01-22T03:50:45.000+0000","gmtModified":"2019-01-22T03:50:57.000+0000","houseTitle":"","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":1850,"houseAddress":"","price":1,"pushDate":"2019-01-22T03:50:57.000+0000","contacts":"","cellPhone":"","qrcodeLink":null},{"lohHouseInfoId":845,"gmtCreate":"2019-01-22T03:50:29.000+0000","gmtModified":"2019-01-22T03:50:29.000+0000","houseTitle":"","userInfoId":3,"lohHouseTypeId":1,"regionInfoProvinceId":1,"regionInfoCityId":35,"regionInfoCountyId":41,"houseAddress":"","price":1,"pushDate":"2019-01-22T03:50:29.000+0000","contacts":"","cellPhone":"","qrcodeLink":null}]},
	    toolbar: [],
	    frozenColumns:[[
	       {field:'houseTitle',title:'房屋标题',width:100},
	    ]],
	    columns:[[
	        {field:'lohHouseTypeId',title:'房屋类型',width:100},
	        {field:'price',title:'房屋价格',width:100},
	        {field:'houseAddress',title:'房屋地址',width:100},
	        {field:'pushDate',title:'发布日期',width:100},
	        {field:'contacts',title:'联系人',width:100},
	        {field:'cellPhone',title:'联系方式',width:100},
	        {field:'qrcodeLink',title:'预览图',width:100},
	        {field:'itemid',title:'查看',width:100},
	        {field:'itemid',title:'收藏',width:100}
	    ]],
	    onBeforeLoad: function(param){
	    	param.pageIndex = param.page;
	    	param.pageSize = param.rows;
	    },
	    loadFilter: function(data){
			if (data.result){
				var result = data.result;
				result = JSON.parse(result);
				result.total = result.totalRecord;
				result.rows = result.page;
				return result;
			} else {
				return data;
			}
		},
	    striped:true,
	    loadMsg:"数据加载中...",
	    emptyMsg: "未查询到数据。",
	    pagination:true,
	    rownumbers:true,
	    singleSelect:true,
	    pagePosition:"bottom",
	    pageNumber:1,
	    pageSize:10,
	    pageList:[10,20,30,40,50,100],
	    queryParams:param
	});

	$(window).resize(resizeDatagrid.bind(this,dg));
}

function resizeDatagrid(dg){
	var options = dg.datagrid("options");
	dg.datagrid(options);
}
</script>
</body>
</html>
</textarea>

<script>

var oTextarea = document.getElementById("textarea");

var domString = oTextarea.value;

var preblob = new Blob([domString],{type:"text/html"});

var blobUrl;
if('msSaveOrOpenBlob' in navigator){
    // Microsoft Edge and Microsoft Internet Explorer 10-11
    blobUrl = window.navigator.msSaveOrOpenBlob(preblob, "temp");
}else{
    // standard code for Google Chrome, Mozilla Firefox etc
    window.URL = window.URL || window.webkitURL;
    blobUrl = URL.createObjectURL(preblob);
}

var menudata = [{"attributes":{"menuUrl":""},"children":[{"attributes":{"menuUrl":""},"children":[{"attributes":{"menuUrl":"./demo.html"},"iconCls":"icon-489","id":6,"state":"open","text":"用户管理"},{"attributes":{"menuUrl":blobUrl},"iconCls":"icon-513","id":26,"state":"open","text":"日志管理"}],"iconCls":"icon-permission","id":2,"state":"closed","text":"系统管理"},{"attributes":{"menuUrl":""},"children":[{"attributes":{"menuUrl":""},"iconCls":"icon-349","id":17,"state":"open","text":"学生成绩管理"}],"iconCls":"icon-student","id":3,"state":"closed","text":"学生管理"},{"attributes":{"menuUrl":""},"iconCls":"icon-course","id":4,"state":"open","text":"教师管理"},{"attributes":{"menuUrl":""},"iconCls":"icon-modifyPassword","id":15,"state":"open","text":"修改密码"},{"attributes":{"menuUrl":""},"iconCls":"icon-exit","id":16,"state":"open","text":"安全退出"}],"iconCls":"icon-home","id":1,"state":"closed","text":"某系统"}];

// 退出登录
function logout(){
	$.messager.confirm('系统提示','您确定要退出系统吗？',function(r){
		if(r){
			window.location.href='logout.htm';
		}
	});
}

// 打开修改密码的窗体
function openPasswordUpdateDialog(){
	url="updatePassword.htm";
	$("#dlg").dialog("open").dialog("setTitle","修改密码");
}

//  关闭修改密码框
function closePasswordUpdateDialog(){
	$("#dlg").dialog("close");
	$("#oldPassword").val("");
	$("#newPassword").val("");
	$("#newPassword2").val("");
}

/**
 * 左边的菜单点击显示
 *  如果存在（即已经打开了），选中他
 *  如果不存在则打开他
 */		
function openTab(node){
	if($("#tabs").tabs("exists",node.text)){
		$("#tabs").tabs("select",node.text);
	}else{
		var content="<iframe frameborder=0 scrolling='auto' style='width:100%;height:100%' src="+node.attributes.menuUrl+"></iframe>"
		$("#tabs").tabs("add",{
			title:node.text,
			iconCls:node.iconCls,
			closable:true,
			content:content
		});
	}
	bindTabEvent();
}

function bindTabEvent(){
	$(".tabs-inner").dblclick(function(){
		var subtitle = $(this).children(".tabs-title").text();
		$('#tabs').tabs('close',subtitle);
	})
	$(".tabs-inner").bind('contextmenu',function(e){
		
		$('#mm').menu('show', {
			left: e.pageX,
			top: e.pageY
		});
		var subtitle =$(this).children(".tabs-title").text();
		$('#mm').data("currtab",subtitle);
		return false;
	});
}

function bindTabMenuEvent(){
	var temp = $('#tabs');
	$('#mm-tabrefresh').click(function(){
		var currtab_title = $('#mm').data("currtab");
		var frame = temp.tabs('getTab', currtab_title).find('iframe')
		frame.attr('src',frame.attr('src'));
	});
	//关闭当前
	$('#mm-tabclose').click(function(){
		var currtab_title = $('#mm').data("currtab");
		$('#tabs').tabs('close',currtab_title);
	})
	//全部关闭
	$('#mm-tabcloseall').click(function(){
		$('.tabs-inner span').each(function(i,n){
			var t = $(n).text();
			$('#tabs').tabs('close',t);
		});	
	});
	//关闭除当前之外的TAB
	$('#mm-tabcloseother').click(function(){
		var currtab_title = $('#mm').data("currtab");
		$('.tabs-inner span').each(function(i,n){
			var t = $(n).text();
			if(t!=currtab_title)
				$('#tabs').tabs('close',t);
		});	
	});
	//关闭当前右侧的TAB
	$('#mm-tabcloseright').click(function(){
		var nextall = $('.tabs-selected').nextAll();
		if(nextall.length==0){
			//msgShow('系统提示','后边没有啦~~','error');
			alert('后边没有啦~~');
			return false;
		}
		nextall.each(function(i,n){
			var t=$('a:eq(0) span',$(n)).text();
			$('#tabs').tabs('close',t);
		});
		return false;
	});
	//关闭当前左侧的TAB
	$('#mm-tabcloseleft').click(function(){
		var prevall = $('.tabs-selected').prevAll();
		if(prevall.length==0){
			alert('到头了，前边没有啦~~');
			return false;
		}
		prevall.each(function(i,n){
			var t=$('a:eq(0) span',$(n)).text();
			$('#tabs').tabs('close',t);
		});
		return false;
	});

}

$(function(){

	// 加载左树菜单
	$("#tree").tree({
		lines:true,
		data:menudata,
		onLoadSuccess:function(){
			$("#tree").tree('expandAll');
		},
		onClick:function(node){
			if(node.id==16){
				logout();
			}else if(node.id==15){
				openPasswordUpdateDialog();
			}else if(node.attributes.menuUrl){
				openTab(node);
			}
		}
	});

	bindTabEvent();
	bindTabMenuEvent();
});


</script>
</body>
</html>
