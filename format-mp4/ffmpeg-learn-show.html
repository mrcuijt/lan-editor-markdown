<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style type="text/css">h1,h2,h3,h4,h5,h6,p,blockquote{margin:0;padding:0}body{font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB",Arial,sans-serif;font-size:13px;line-height:18px;color:#737373;margin:10px 13px 10px 13px}a{color:#0069d6}a:hover{color:#0050a3;text-decoration:none}a img{border:0}p{margin-bottom:9px}h1,h2,h3,h4,h5,h6{color:#404040;line-height:36px}h1{margin-bottom:18px;font-size:30px}h2{font-size:24px}h3{font-size:18px}h4{font-size:16px}h5{font-size:14px}h6{font-size:13px}hr{margin:0 0 19px;border:0;border-bottom:1px solid #ccc}blockquote{padding:13px 13px 21px 15px;margin-bottom:18px;font-family:georgia,serif;font-style:italic}blockquote:before{content:"C";font-size:40px;margin-left:-10px;font-family:georgia,serif;color:#eee}blockquote p{font-size:14px;font-weight:300;line-height:18px;margin-bottom:0;font-style:italic}code,pre{font-family:Monaco,Andale Mono,Courier New,monospace}code{background-color:#fee9cc;color:rgba(0,0,0,0.75);padding:1px 3px;font-size:12px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}pre{display:block;padding:14px;margin:0 0 18px;line-height:16px;font-size:11px;border:1px solid #d9d9d9;white-space:pre-wrap;word-wrap:break-word}pre code{background-color:#fff;color:#737373;font-size:11px;padding:0}@media screen and (min-width:768px){body{width:748px;margin:10px auto}}body{font-family:Helvetica,Geneva,Arial,sans-serif;font-size:1em;font-style:normal;font-weight:400;color:#333;background-color:#fff;line-height:2em}body.with_sponsor{margin-right:410px}a{color:#5a86e4;text-decoration:none}a:hover{text-decoration:underline}a.external,a[href*="//"]:not([href*="alexgorbatchev.com"]){background:url(external.png) right 50% no-repeat;padding-right:12px}.file-list,code,pre{font-family:Consolas,Monaco,"Bitstream Vera Sans Mono","Courier New",Courier,monospace}table{-moz-border-radius:5px;-webkit-border-radius:5px 5px 5px 5px;border:2px solid #adadad;padding:.5em;width:100%}table td,table th{padding:.3em .5em;vertical-align:top}table th{text-align:left}table tbody>tr:hover{background:#cbe2ff;-moz-border-radius:3px;-webkit-border-radius:3px 3px 3px 3px}table tbody>tr>td:first-child{white-space:nowrap}#clear{clear:both}#title h1{font-weight:700;font-size:4em;color:#adadad;margin:0;line-height:100%}#title h1 #whatsnew{display:inline}#title h1 #whatsnew a{font-size:.5em;color:red}#title h2{font-size:1.45em}#title #forkme{display:block;position:fixed;z-index:5;top:0;left:0;border:0;background:url(forkme.png) no-repeat;width:149px;height:149px;text-indent:-1000px;overflow:hidden}#content .date,#content .version,.badge{-moz-border-radius:3px;-webkit-border-radius:3px 3px 3px 3px;font-size:10px;font-weight:400;padding:3px 5px 4px;line-height:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}#content .sponsor,#theme-example{-moz-border-radius:5px;-webkit-border-radius:5px 5px 5px 5px}#content #news ul{list-style-type:none;margin:0;padding:0}#content #news ul li{position:relative;display:block;padding-left:7em;min-height:22px}#blurb,#content .date,#footer,#meta,.float{position:absolute;width:10em;text-align:right}#content .date{background:#cbe2ff;color:#5a86e4;height:20px;left:0;top:0;padding:6px 5px 0}#content .version{background:#adadad;color:#fff}#content h3{margin:1.5em 0 .5em;font-size:1.45em}#content h2>a[name]{color:#000;text-decoration:none}#content .sponsor{padding:.1em 1em;background:#feffcb;margin-bottom:1em}#footer,#sponsor{-moz-border-radius:3px;-webkit-border-radius:3px 3px 3px 3px}#content li>p:only-child{margin:0}#blurb,#footer,#meta,.float{top:10px;right:10px;padding:1em;line-height:1.1em}#blurb a,#footer a,#meta a,.float a{display:block}.with_sponsor #blurb,.with_sponsor #footer,.with_sponsor #meta,.with_sponsor .float{right:190px}#sponsor{position:fixed;top:10px;right:10px;bottom:10px;background:#6380EA}#sponsor a{padding:0;background:0 0}#meta{z-index:2;font-weight:700;padding-top:7em}#footer{background:#cbe2ff;padding-top:14em;z-index:1}#footer #ad{margin-bottom:.5em}#blurb{text-align:left;z-index:2}#blurb a{display:inline}#blurb em{font-size:80%}#copyright{color:#adadad;font-size:1.2em;margin-top:3em}#theme-example{padding:1em 2em;background-color:#adadad}.code>.container>.line,.code>.container>.line>.java,.code>.container>.line>.js,.code>.container>.line>code,.gutter>.line{height:14px!important;line-height:14px!important;font-size:14px!important;font-family:"courier new"!important}#code_source{border:1px solid #ccc;width:998px;height:200px}#code_type{width:170px;border:1px solid #bbb;height:28px;line-height:28px}.syntaxhighlighter .comments,.syntaxhighlighter .comments a,.syntaxhighlighter .plain,.syntaxhighlighter .plain a,.syntaxhighlighter .string,.syntaxhighlighter .string a{height:14px!important;line-height:14px!important;font-size:14px!important;font-family:"courier new"!important}.syntaxhighlighter .plain,.syntaxhighlighter .plain a{color:#000!important}.syntaxhighlighter a,.syntaxhighlighter code,.syntaxhighlighter div,.syntaxhighlighter table,.syntaxhighlighter table caption,.syntaxhighlighter table tbody,.syntaxhighlighter table td,.syntaxhighlighter table thead,.syntaxhighlighter table tr,.syntaxhighlighter textarea{-moz-border-radius:0!important;-webkit-border-radius:0!important;background:0 0!important;border:0!important;bottom:auto!important;float:none!important;height:auto!important;left:auto!important;line-height:1.1em!important;margin:0!important;outline:0!important;overflow:visible!important;padding:0!important;position:static!important;right:auto!important;text-align:left!important;top:auto!important;vertical-align:baseline!important;width:auto!important;box-sizing:content-box!important;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;font-weight:400!important;font-style:normal!important;font-size:1em!important;min-height:inherit!important;min-height:auto!important}.syntaxhighlighter,.syntaxhighlighter table td.code .container{position:relative!important}.syntaxhighlighter,.syntaxhighlighter table,.syntaxhighlighter table td.code{width:100%!important}.syntaxhighlighter .bold,.syntaxhighlighter.printing .script{font-weight:700!important}.syntaxhighlighter{margin:1em 0!important;overflow:auto!important;font-size:1em!important}.syntaxhighlighter.source{overflow:hidden!important}.syntaxhighlighter .italic{font-style:italic!important}.syntaxhighlighter .line{white-space:pre!important}.syntaxhighlighter table caption{text-align:left!important;padding:.5em 0 .5em 1em!important}.syntaxhighlighter table td.code .container textarea{box-sizing:border-box!important;position:absolute!important;left:0!important;top:0!important;width:100%!important;height:100%!important;border:none!important;background:#fff!important;padding-left:1em!important;overflow:hidden!important;white-space:pre!important}.syntaxhighlighter table td.gutter .line{text-align:right!important;padding:0 .5em 0 1em!important}.syntaxhighlighter table td.code .line{padding:0 1em!important}.syntaxhighlighter.nogutter td.code .container textarea,.syntaxhighlighter.nogutter td.code .line{padding-left:0!important}.syntaxhighlighter.show{display:block!important}.syntaxhighlighter.collapsed table{display:none!important}.syntaxhighlighter.collapsed .toolbar{padding:.1em .8em 0!important;font-size:1em!important;position:static!important;width:auto!important;height:auto!important}.syntaxhighlighter.collapsed .toolbar span{display:inline!important;margin-right:1em!important}.syntaxhighlighter.collapsed .toolbar span a{padding:0!important;display:none!important}.syntaxhighlighter .toolbar span.title,.syntaxhighlighter.collapsed .toolbar span a.expandSource{display:inline!important}.syntaxhighlighter .toolbar{position:absolute!important;right:1px!important;top:1px!important;width:11px!important;height:11px!important;font-size:10px!important;z-index:10!important}.syntaxhighlighter .toolbar a{display:block!important;text-align:center!important;text-decoration:none!important;padding-top:1px!important}.syntaxhighlighter .toolbar a.expandSource,.syntaxhighlighter.printing .toolbar{display:none!important}.syntaxhighlighter.ie{font-size:.9em!important;padding:1px 0!important}.syntaxhighlighter.ie .toolbar{line-height:8px!important}.syntaxhighlighter.ie .toolbar a{padding-top:0!important}.syntaxhighlighter.printing .line.alt1 .content,.syntaxhighlighter.printing .line.alt2 .content,.syntaxhighlighter.printing .line.highlighted .number,.syntaxhighlighter.printing .line.highlighted.alt1 .content,.syntaxhighlighter.printing .line.highlighted.alt2 .content{background:0 0!important}.syntaxhighlighter.printing .line .number{color:#bbb!important}.syntaxhighlighter.printing .line .content,.syntaxhighlighter.printing .plain,.syntaxhighlighter.printing .plain a{color:#000!important}.syntaxhighlighter.printing a{text-decoration:none!important}.syntaxhighlighter.printing .comments,.syntaxhighlighter.printing .comments a{color:#008200!important}.syntaxhighlighter.printing .string,.syntaxhighlighter.printing .string a{color:#00f!important}.syntaxhighlighter.printing .keyword{color:#069!important;font-weight:700!important}.syntaxhighlighter.printing .preprocessor{color:gray!important}.syntaxhighlighter.printing .variable{color:#a70!important}.syntaxhighlighter.printing .value{color:#090!important}.syntaxhighlighter.printing .functions{color:#ff1493!important}.syntaxhighlighter.printing .constants{color:#06c!important}.syntaxhighlighter.printing .color1,.syntaxhighlighter.printing .color1 a{color:gray!important}.syntaxhighlighter.printing .color2,.syntaxhighlighter.printing .color2 a{color:#ff1493!important}.syntaxhighlighter.printing .color3,.syntaxhighlighter.printing .color3 a{color:red!important}.syntaxhighlighter.printing .break,.syntaxhighlighter.printing .break a{color:#000!important}.syntaxhighlighter a,.syntaxhighlighter code,.syntaxhighlighter div,.syntaxhighlighter table,.syntaxhighlighter table caption,.syntaxhighlighter table tbody,.syntaxhighlighter table td,.syntaxhighlighter table thead,.syntaxhighlighter table tr,.syntaxhighlighter textarea{-moz-border-radius:0!important;-webkit-border-radius:0!important;background:0 0!important;border:0!important;bottom:auto!important;float:none!important;height:auto!important;left:auto!important;line-height:1.1em!important;margin:0!important;outline:0!important;overflow:visible!important;padding:0!important;position:static!important;right:auto!important;text-align:left!important;top:auto!important;vertical-align:baseline!important;width:auto!important;box-sizing:content-box!important;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;font-weight:400!important;font-style:normal!important;font-size:1em!important;min-height:inherit!important;min-height:auto!important}.syntaxhighlighter,.syntaxhighlighter table td.code .container{position:relative!important}.syntaxhighlighter,.syntaxhighlighter table,.syntaxhighlighter table td.code{width:100%!important}.syntaxhighlighter .bold,.syntaxhighlighter .keyword,.syntaxhighlighter .script,.syntaxhighlighter.printing .script{font-weight:700!important}.syntaxhighlighter{margin:1em 0!important;overflow:auto!important;font-size:1em!important}.syntaxhighlighter.source{overflow:hidden!important}.syntaxhighlighter .italic{font-style:italic!important}.syntaxhighlighter .line{white-space:pre!important}.syntaxhighlighter table caption{text-align:left!important;padding:.5em 0 .5em 1em!important}.syntaxhighlighter table td.code .container textarea{box-sizing:border-box!important;position:absolute!important;left:0!important;top:0!important;width:100%!important;height:100%!important;border:none!important;background:#fff!important;padding-left:1em!important;overflow:hidden!important;white-space:pre!important}.syntaxhighlighter table td.gutter .line{text-align:right!important;padding:0 .5em 0 1em!important}.syntaxhighlighter table td.code .line{padding:0 1em!important}.syntaxhighlighter.nogutter td.code .container textarea,.syntaxhighlighter.nogutter td.code .line{padding-left:0!important}.syntaxhighlighter.show{display:block!important}.syntaxhighlighter.collapsed table{display:none!important}.syntaxhighlighter.collapsed .toolbar{padding:.1em .8em 0!important;font-size:1em!important;position:static!important;width:auto!important;height:auto!important}.syntaxhighlighter.collapsed .toolbar span{display:inline!important;margin-right:1em!important}.syntaxhighlighter.collapsed .toolbar span a{padding:0!important;display:none!important}.syntaxhighlighter .toolbar span.title,.syntaxhighlighter.collapsed .toolbar span a.expandSource{display:inline!important}.syntaxhighlighter .toolbar{position:absolute!important;right:1px!important;top:1px!important;width:11px!important;height:11px!important;font-size:10px!important;z-index:10!important}.syntaxhighlighter .toolbar a{display:block!important;text-align:center!important;text-decoration:none!important;padding-top:1px!important}.syntaxhighlighter .toolbar a.expandSource,.syntaxhighlighter.printing .toolbar{display:none!important}.syntaxhighlighter.ie{font-size:.9em!important;padding:1px 0!important}.syntaxhighlighter.ie .toolbar{line-height:8px!important}.syntaxhighlighter.ie .toolbar a{padding-top:0!important}.syntaxhighlighter.printing .line.alt1 .content,.syntaxhighlighter.printing .line.alt2 .content,.syntaxhighlighter.printing .line.highlighted .number,.syntaxhighlighter.printing .line.highlighted.alt1 .content,.syntaxhighlighter.printing .line.highlighted.alt2 .content{background:0 0!important}.syntaxhighlighter.printing .line .number{color:#bbb!important}.syntaxhighlighter.printing .line .content,.syntaxhighlighter.printing .plain,.syntaxhighlighter.printing .plain a{color:#000!important}.syntaxhighlighter.printing a{text-decoration:none!important}.syntaxhighlighter.printing .comments,.syntaxhighlighter.printing .comments a{color:#008200!important}.syntaxhighlighter.printing .string,.syntaxhighlighter.printing .string a{color:#00f!important}.syntaxhighlighter.printing .keyword{color:#069!important;font-weight:700!important}.syntaxhighlighter.printing .preprocessor{color:gray!important}.syntaxhighlighter.printing .variable{color:#a70!important}.syntaxhighlighter.printing .value{color:#090!important}.syntaxhighlighter.printing .functions{color:#ff1493!important}.syntaxhighlighter.printing .constants{color:#06c!important}.syntaxhighlighter.printing .color1,.syntaxhighlighter.printing .color1 a{color:gray!important}.syntaxhighlighter.printing .color2,.syntaxhighlighter.printing .color2 a{color:#ff1493!important}.syntaxhighlighter.printing .color3,.syntaxhighlighter.printing .color3 a{color:red!important}.syntaxhighlighter .line.highlighted.number,.syntaxhighlighter table caption,.syntaxhighlighter.printing .break,.syntaxhighlighter.printing .break a{color:#000!important}.syntaxhighlighter,.syntaxhighlighter .line.alt1,.syntaxhighlighter .line.alt2{background-color:#fff!important}.syntaxhighlighter .line.highlighted.alt1,.syntaxhighlighter .line.highlighted.alt2{background-color:#e0e0e0!important}.syntaxhighlighter .gutter{color:#afafaf!important}.syntaxhighlighter .gutter .line{border-right:3px solid #6ce26c!important}.syntaxhighlighter .gutter .line.highlighted{background-color:#6ce26c!important;color:#fff!important}.syntaxhighlighter.printing .line .content{border:none!important}.syntaxhighlighter.collapsed{overflow:visible!important}.syntaxhighlighter.collapsed .toolbar{color:#00f!important;background:#fff!important;border:1px solid #6ce26c!important}.syntaxhighlighter.collapsed .toolbar a{color:#00f!important}.syntaxhighlighter.collapsed .toolbar a:hover{color:red!important}.syntaxhighlighter .toolbar{color:#fff!important;background:#6ce26c!important;border:none!important}.syntaxhighlighter .toolbar a{color:#fff!important}.syntaxhighlighter .plain,.syntaxhighlighter .plain a,.syntaxhighlighter .toolbar a:hover{color:#000!important}.syntaxhighlighter .comments,.syntaxhighlighter .comments a{color:#008200!important}.syntaxhighlighter .string,.syntaxhighlighter .string a{color:#00f!important}.syntaxhighlighter .keyword{color:#069!important}.syntaxhighlighter .preprocessor{color:gray!important}.syntaxhighlighter .variable{color:#a70!important}.syntaxhighlighter .value{color:#090!important}.syntaxhighlighter .functions{color:#ff1493!important}.syntaxhighlighter .constants{color:#06c!important}.syntaxhighlighter .script{color:#069!important;background-color:none!important}.syntaxhighlighter .color1,.syntaxhighlighter .color1 a{color:gray!important}.syntaxhighlighter .color2,.syntaxhighlighter .color2 a{color:#ff1493!important}.syntaxhighlighter .color3,.syntaxhighlighter .color3 a{color:red!important}.syntaxhighlighter table{margin:1px 0!important}</style><title>ffmpeg-learn-show</title></head><body><h4 id="ffmpeglearn">ffmpeg-learn</h4>

<h4 id="ffmpeg">FFmpeg 音视频同步基础知识</h4>

<h5 id="1ipb">1. I帧/P帧/B帧</h5>

<ul>
<li><p>I帧：I帧(Intra-coded picture, 帧内编码帧，常称为关键帧)包含一幅完整的图像信息，属于帧内编码图像，不含运动矢量，在解码时不需要参考其他帧图像。因此在I帧图像处可以切换频道，而不会导致图像丢失或无法解码。I帧图像用于阻止误差的累积和扩散。在闭合式 GOP 中，每个 GOP 的第一个帧一定是 I帧，且当前 GOP 的数据不会参考前后 GOP 的数据。</p></li>
<li><p>P帧：P帧(Predictive-coded picture, 预测编码图像帧)是帧间编码帧，利用之前的 I帧 或 P帧进行预测编码。</p></li>
<li><p>B帧：B帧(Bi-directionally predicted picture, 双向预测编码图像帧)是帧间编码帧，利用之前和(或)之后的 I帧或 P帧进行双向预测编码。B帧不可以作为参考帧。</p>

<p>B帧具有更高的压缩率，但需要更多的缓冲时间以及更高的 CPU 占用率，因此 B帧适合本地存储以及视频点播，而不适用对实时性要求较高的直播系统。</p></li>
</ul>

<h5 id="2dtspts">2. DTS和PTS</h5>

<ul>
<li><p>DTS(Decoding Time Stamp, 解码时间戳)，表示压缩帧的解码时间。</p></li>
<li><p>PTS(Presentation Time Stamp, 显示时间戳)，表示将压缩帧解码后得到的原始帧的显示时间。</p></li>
</ul>

<p>音频中 DTS 和 PTS 是相同的。视频中由于B帧需要双向预测，B帧依赖于其前和其后的帧，因此含B帧的视频解码顺序与显示顺序不同，即 DTS 与 PTS 不同。当然，不含B帧的视频，其 DTS 和 PTS 是相同的。下图以一个开放式 GOP 示意图为例，说明视频流的解码顺序和显示顺序</p>

<p><img title="" alt="title" src="images/ffmpeg-learn/ffmpeg-learn-001.jpg"></p>

<p><strong>采集顺序</strong>指图像传感器采集原始信号得到图像帧的顺序。</p>

<p><strong>编码顺序</strong>指编码器编码后图像帧的顺序。存储到磁盘的本地视频文件中图像帧的顺序与编码顺序相同。</p>

<p><strong>传输顺序</strong>指编码后的流在网络中传输过程中图像帧的顺序。</p>

<p><strong>解码顺序</strong>指解码器解码图像帧的顺序。</p>

<p><strong>显示顺序</strong>指图像帧在显示器上显示的顺序。</p>

<p><strong>采集顺序与显示顺序相同。编码顺序、传输顺序和解码顺序相同。</strong></p>

<p>以图中“B[1]”帧为例进行说明，“B[1]”帧解码时需要参考“I[0]”帧和“P[3]”帧，因此“P[3]”帧必须比“B[1]”帧先解码。这就导致了解码顺序和显示顺序的不一致，后显示的帧需要先解码。</p>

<h5 id="3ffmpeg">3. FFmpeg 中的时间基与时间戳</h5>

<h6 id="31">3.1 时间基与时间戳的概念</h6>

<p>在 FFmpeg 中，时间基(time_base)是时间戳(timestamp)的单位，时间戳值乘以时间基，可以得到实际的时刻值(以秒等为单位)。例如，如果一个视频帧的 dts 是 40，pts 是 160，其 time_base 是 1/1000 秒，那么可以计算出此视频帧的解码时刻是 40 毫秒(40/1000)，显示时刻是 160 毫秒(160/1000)。FFmpeg 中时间戳(pts/dts)的类型是 int64_t 类型，把一个 time_base 看作一个时钟脉冲，则可把 dts/pts 看作时钟脉冲的计数。</p>

<h6 id="32tbrtbntbc">3.2 三种时间基 tbr、tbn 和 tbc</h6>

<p>不同的封装格式具有不同的时间基。在 FFmpeg 处理音视频过程中的不同阶段，也会采用不同的时间基。</p>

<p>FFmepg 中有三种时间基，命令行中 tbr、tbn 和 tbc 的打印值就是这三种时间基的倒数：</p>

<ul>
<li><p>tbn：对应容器中的时间基。值是 AVStream.time_base 的倒数</p></li>
<li><p>tbc：对应编解码器中的时间基。值是 AVCodecContext.time_base 的倒数</p></li>
<li><p>tbr：从视频流中猜算得到，可能是帧率或场率(帧率的 2 倍)</p></li>
</ul>

<p>测试文件下载(右键另存为)：<a href="datas/ffmpeg-learn/tnmil3.flv" target="_blank">tnmil3.flv</a></p>

<p>使用 ffprobe 探测媒体文件格式，如下：</p>

<div><div class="syntaxhighlighter  python" id="highlighter_402053"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">ffprobe tnmil3.flv</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="python functions">Input</code> <code class="python comments">#0, flv, from 'tnmil3.flv':</code></div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">Metadata:</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">encoder&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Lavf58.</code><code class="python value">20.100</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">Duration: </code><code class="python value">00</code><code class="python plain">:</code><code class="python value">00</code><code class="python plain">:</code><code class="python value">03.60</code><code class="python plain">, start: </code><code class="python value">0.017000</code><code class="python plain">, bitrate: </code><code class="python value">513</code> <code class="python plain">kb</code><code class="python keyword">/</code><code class="python plain">s</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Stream </code><code class="python comments">#0:0: Video: h264 (High), yuv420p(progressive), 784x480, 25 fps, 25 tbr, 1k tbn, 50 tbc</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Stream </code><code class="python comments">#0:1: Audio: aac (LC), 44100 Hz, stereo, fltp, 128 kb/s</code></div></div></td></tr></tbody></table></div></div>

<p>关于 tbr、tbn 和tbc 的说明，原文如下，来自 FFmpeg 邮件列表：</p>

<div><div class="syntaxhighlighter  text" id="highlighter_477015"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="text plain">There are three different time bases for time stamps in FFmpeg. The</code></div><div class="line number2 index1 alt1"><code class="text plain">values printed are actually reciprocals of these, i.e. 1/tbr, 1/tbn and</code></div><div class="line number3 index2 alt2"><code class="text plain">1/tbc.</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="text plain">tbn is the time base in AVStream that has come from the container, I</code></div><div class="line number6 index5 alt1"><code class="text plain">think. It is used for all AVStream time stamps.</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="text plain">tbc is the time base in AVCodecContext for the codec used for a</code></div><div class="line number9 index8 alt2"><code class="text plain">particular stream. It is used for all AVCodecContext and related time</code></div><div class="line number10 index9 alt1"><code class="text plain">stamps.</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="text plain">tbr is guessed from the video stream and is the value users want to see</code></div><div class="line number13 index12 alt2"><code class="text plain">when they look for the video frame rate, except sometimes it is twice</code></div><div class="line number14 index13 alt1"><code class="text plain">what one would expect because of field rate versus frame rate.</code></div></div></td></tr></tbody></table></div></div>

<h6 id="33av_time_base">3.3 内部时间基 AV_TIME_BASE</h6>

<p>除以上三种时间基外，FFmpeg 还有一个内部时间基 AV_TIME_BASE (以及分数形式的 AV_TIME_BASE_Q)</p>

<div><div class="syntaxhighlighter  c" id="highlighter_193987"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c comments">// Internal time base represented as integer</code></div><div class="line number2 index1 alt1"><code class="c preprocessor">#define AV_TIME_BASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1000000</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="c comments">// Internal time base represented as fractional value</code></div><div class="line number5 index4 alt2"><code class="c preprocessor">#define AV_TIME_BASE_Q (AVRational){1, AV_TIME_BASE}</code></div></div></td></tr></tbody></table></div></div>

<p>AV_TIME_BASE 及 AV_TIME_BASE_Q 用于 FFmpeg 内部函数处理，使用此时间基计算得到时间值表示的是微秒。</p>

<h6 id="34">3.4 时间值形式转换</h6>

<p>av_q2d() 将时间从 AVRational 形式转换为 double 形式。AVRational 是分数类型，double 是双精度浮点数类型，转换的结果单位是秒。转换前后的值基于同一时间基，仅仅是数值的表现形式不同而已。</p>

<p>av_q2d() 实现如下：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_120175"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c comments">/**</code></div><div class="line number2 index1 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* Convert an AVRational to a `double`.</code></div><div class="line number3 index2 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">* @param a AVRational to convert</code></div><div class="line number4 index3 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* @return `a` in floating-point form</code></div><div class="line number5 index4 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">* @see av_d2q()</code></div><div class="line number6 index5 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">*/</code></div><div class="line number7 index6 alt2"><code class="c keyword bold">static</code> <code class="c plain">av_q2d(AVRational a){</code></div><div class="line number8 index7 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c keyword bold">return</code> <code class="c plain">a.num / () a.den;</code></div><div class="line number9 index8 alt2"><code class="c plain">}</code></div></div></td></tr></tbody></table></div></div>

<p>av_q2d() 使用方法如下：</p>

<div><div class="syntaxhighlighter  text" id="highlighter_462250"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="text plain">AVStream stream;</code></div><div class="line number2 index1 alt1"><code class="text plain">AVPacket packet; </code></div><div class="line number3 index2 alt2"><code class="text plain">packet播放时刻值：timestamp(单位秒) = packet.pts × av_q2d(stream.time_base); </code></div><div class="line number4 index3 alt1"><code class="text plain">packet播放时长值：duration(单位秒) = packet.duration × av_q2d(stream.time_base);</code></div></div></td></tr></tbody></table></div></div>

<h6 id="35">3.5 时间基转换函数</h6>

<p>av_rescale_q() 用于不同时间基的转换，用于将时间值从一种时间基转换为另一种时间基。</p>

<div><div class="syntaxhighlighter  c" id="highlighter_587252"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c comments">/**</code></div><div class="line number2 index1 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* Rescale a 64-bit integer by 2 rational numbers.</code></div><div class="line number3 index2 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">*</code></div><div class="line number4 index3 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* The operation is mathematically equivalent to `a × bq / cq`.</code></div><div class="line number5 index4 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">*</code></div><div class="line number6 index5 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* This function is equivalent to av_rescale_q_rnd() with #AV_ROUND_NEAR_INF.</code></div><div class="line number7 index6 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">*</code></div><div class="line number8 index7 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* @see av_rescale(), av_rescale_rnd(), av_rescale_q_rnd()</code></div><div class="line number9 index8 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">*/</code></div><div class="line number10 index9 alt1"><code class="c plain">int64_t av_rescale_q(int64_t a, AVRational bq, AVRational cq) av_const;</code></div></div></td></tr></tbody></table></div></div>

<p>av_packet_rescale_ts() 用于将 AVPacket 中各种时间值从一种时间基转换为另一种时间基。</p>

<div><div class="syntaxhighlighter  c" id="highlighter_620458"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c comments">/**</code></div><div class="line number2 index1 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* Convert valid timing fields (timestamps / durations) in a packet from one</code></div><div class="line number3 index2 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">* timebase to another. Timestamps with unknown values (AV_NOPTS_VALUE) will be</code></div><div class="line number4 index3 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* ignored.</code></div><div class="line number5 index4 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">*</code></div><div class="line number6 index5 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">* @param pkt packet on which the conversion will be performed</code></div><div class="line number7 index6 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">* @param tb_src source timebase, in which the timing fields in pkt are</code></div><div class="line number8 index7 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expressed</code></div><div class="line number9 index8 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">* @param tb_dst destination timebase, to which the timing fields will be</code></div><div class="line number10 index9 alt1"><code class="c spaces">&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; converted</code></div><div class="line number11 index10 alt2"><code class="c spaces">&nbsp;</code><code class="c comments">*/</code></div><div class="line number12 index11 alt1"><code class="c plain">av_packet_rescale_ts(AVPacket *pkt, AVRational tb_src, AVRational tb_dst);</code></div></div></td></tr></tbody></table></div></div>

<h6 id="36">3.6 转封装过程中的时间基转换</h6>

<p>容器中的时间基(AVStream.time_base，3.2节中的 tbn)定义如下：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_858618"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c keyword bold">typedef</code> <code class="c plain">AVStream {</code></div><div class="line number2 index1 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c plain">......</code></div><div class="line number3 index2 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">/**</code></div><div class="line number4 index3 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* This is the fundamental unit of time (in seconds) in terms</code></div><div class="line number5 index4 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* of which frame timestamps are represented.</code></div><div class="line number6 index5 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*</code></div><div class="line number7 index6 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* decoding: set by libavformat</code></div><div class="line number8 index7 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* encoding: May be set by the caller before avformat_write_header() to</code></div><div class="line number9 index8 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; provide a hint to the muxer about the desired timebase. In</code></div><div class="line number10 index9 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avformat_write_header(), the muxer will overwrite this field</code></div><div class="line number11 index10 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; with the timebase that will actually be used for the timestamps</code></div><div class="line number12 index11 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; written into the file (which may or may not be related to the</code></div><div class="line number13 index12 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user-provided one, depending on the format).</code></div><div class="line number14 index13 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*/</code></div><div class="line number15 index14 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c plain">AVRational time_base;</code></div><div class="line number16 index15 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c plain">......</code></div><div class="line number17 index16 alt2"><code class="c plain">}</code></div></div></td></tr></tbody></table></div></div>

<p>AVStream.time_base 是 AVPacket 中 pts 和 dts 的时间单位，输入流与输出流中 time_base 按如下方式确定：</p>

<ul>
<li><p>对于输入流：打开输入文件后，调用 avformat_find_stream_info() 可获取到每个流中的 time_base</p></li>
<li><p>对于输出流：打开输出文件后，调用 avformat_write_header() 可根据输出文件封装格式确定每个流的 time_base 并写入输出文件中</p></li>
</ul>

<p>不同封装格式具有不同的时间基，在转封装(将一种封装格式转换为另一种封装格式)过程中，时间基转换相关代码如下：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_77101"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c plain">av_read_frame(ifmt_ctx, &amp;pkt);</code></div><div class="line number2 index1 alt1"><code class="c plain">pkt.pts = av_rescale_q_rnd(pkt.pts, in_stream-&gt;time_base, out_stream-&gt;time_base, AV_ROUND_NEAR_INF|AV_ROUND_PASS_MINMAX);</code></div><div class="line number3 index2 alt2"><code class="c plain">pkt.dts = av_rescale_q_rnd(pkt.dts, in_stream-&gt;time_base, out_stream-&gt;time_base, V_ROUND_NEAR_INF|AV_ROUND_PASS_MINMAX);</code></div><div class="line number4 index3 alt1"><code class="c plain">pkt.duration = av_rescale_q(pkt.duration, in_stream-&gt;time_base, ut_stream-&gt;time_base);</code></div></div></td></tr></tbody></table></div></div>

<p>下面的代码具有和上面代码相同的效果：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_236566"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c comments">// 从输入文件中读取packet</code></div><div class="line number2 index1 alt1"><code class="c plain">av_read_frame(ifmt_ctx, &amp;pkt);</code></div><div class="line number3 index2 alt2"><code class="c comments">// 将packet中的各时间值从输入流封装格式时间基转换到输出流封装格式时间基 av_packet_rescale_ts(&amp;pkt, in_stream-&gt;time_base, out_stream-&gt;time_base);</code></div></div></td></tr></tbody></table></div></div>

<p>这里流里的时间基 in_stream-&gt;time_base 和 out_stream-&gt;time_base，是容器中的时间基，就是3.2节中的 tbn。</p>

<p>例如，flv 封装格式的 time_base 为 {1,1000}，ts 封装格式的 time_base 为 {1,90000}</p>

<p>我们编写程序将 flv 封装格式转换为 ts 封装格式，抓取原文件(flv)的前四帧显示时间戳：</p>

<div><div class="syntaxhighlighter  python" id="highlighter_974379"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">ffprobe </code><code class="python keyword">-</code><code class="python plain">show_frames </code><code class="python keyword">-</code><code class="python plain">select_streams v tnmil3.flv | findstr pkt_pts</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="python functions">Input</code> <code class="python comments">#0, flv, from 'tnmil3.flv':</code></div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">Metadata:</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">encoder&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Lavf58.</code><code class="python value">20.100</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">Duration: </code><code class="python value">00</code><code class="python plain">:</code><code class="python value">00</code><code class="python plain">:</code><code class="python value">03.60</code><code class="python plain">, start: </code><code class="python value">0.017000</code><code class="python plain">, bitrate: </code><code class="python value">513</code> <code class="python plain">kb</code><code class="python keyword">/</code><code class="python plain">s</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Stream </code><code class="python comments">#0:0: Video: h264 (High), yuv420p(progressive), 784x480, 25 fps, 25 t</code></div><div class="line number8 index7 alt1"><code class="python plain">br, </code><code class="python value">1k</code> <code class="python plain">tbn, </code><code class="python value">50</code> <code class="python plain">tbc</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Stream </code><code class="python comments">#0:1: Audio: aac (LC), 44100 Hz, stereo, fltp, 128 kb/s</code></div><div class="line number10 index9 alt1"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">80</code></div><div class="line number11 index10 alt2"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.080000</code></div><div class="line number12 index11 alt1"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">120</code></div><div class="line number13 index12 alt2"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.120000</code></div><div class="line number14 index13 alt1"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">160</code></div><div class="line number15 index14 alt2"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.160000</code></div><div class="line number16 index15 alt1"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">200</code></div><div class="line number17 index16 alt2"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.200000</code></div><div class="line number18 index17 alt1"><code class="python plain">...</code></div></div></td></tr></tbody></table></div></div>

<p>再抓取转换的文件(ts)的前四帧显示时间戳：</p>

<div><div class="syntaxhighlighter  python" id="highlighter_916137"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">ffprobe </code><code class="python keyword">-</code><code class="python plain">show_frames </code><code class="python keyword">-</code><code class="python plain">select_streams v tnmil3.ts | grep pkt_pts&nbsp; </code></div><div class="line number2 index1 alt1"><code class="python plain">ffprobe version </code><code class="python value">4.1</code> <code class="python plain">Copyright (c) </code><code class="python value">2007</code><code class="python keyword">-</code><code class="python value">2018</code> <code class="python plain">the FFmpeg developers</code></div><div class="line number3 index2 alt2"><code class="python functions">Input</code> <code class="python comments">#0, mpegts, from 'tnmil3.ts':</code></div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">Duration: </code><code class="python value">00</code><code class="python plain">:</code><code class="python value">00</code><code class="python plain">:</code><code class="python value">03.58</code><code class="python plain">, start: </code><code class="python value">0.017000</code><code class="python plain">, bitrate: </code><code class="python value">619</code> <code class="python plain">kb</code><code class="python keyword">/</code><code class="python plain">s</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">Program </code><code class="python value">1</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Metadata:</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">service_name&nbsp;&nbsp;&nbsp; : Service01</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">service_provider: FFmpeg</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Stream </code><code class="python comments">#0:0[0x100]: Video: h264 (High) ([27][0][0][0] / 0x001B), yuv420p(progressive), 784x480, 25 fps, 25 tbr, 90k tbn, 50 tbc</code></div><div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Stream </code><code class="python comments">#0:1[0x101]: Audio: aac (LC) ([15][0][0][0] / 0x000F), 44100 Hz, stereo, fltp, 127 kb/s</code></div><div class="line number11 index10 alt2"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">7200</code></div><div class="line number12 index11 alt1"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.080000</code></div><div class="line number13 index12 alt2"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">10800</code></div><div class="line number14 index13 alt1"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.120000</code></div><div class="line number15 index14 alt2"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">14400</code></div><div class="line number16 index15 alt1"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.160000</code></div><div class="line number17 index16 alt2"><code class="python plain">pkt_pts</code><code class="python keyword">=</code><code class="python value">18000</code></div><div class="line number18 index17 alt1"><code class="python plain">pkt_pts_time</code><code class="python keyword">=</code><code class="python value">0.200000</code></div></div></td></tr></tbody></table></div></div>

<p>可以发现，对于同一个视频帧，它们时间基 (tbn) 不同因此时间戳 (pkt_pts) 也不同，但是计算出来的时刻值 (pkt_pts_time) 是相同的。</p>

<p>看第一帧的时间戳，计算关系：<strong>80×{1,1000} == 7200×{1,90000} == 0.080000</strong></p>

<h6 id="37">3.7 转码过程中的时间基转换</h6>

<p>编解码器中的时间基(AVCodecContext.time_base，3.2节中的 tbc)定义如下：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_564991"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c keyword bold">typedef</code> <code class="c keyword bold">struct</code> <code class="c plain">AVCodecContext {</code></div><div class="line number2 index1 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c plain">......</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">/**</code></div><div class="line number5 index4 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* This is the fundamental unit of time (in seconds) in terms</code></div><div class="line number6 index5 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* of which frame timestamps are represented. For fixed-fps content,</code></div><div class="line number7 index6 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* timebase should be 1/framerate and timestamp increments should be</code></div><div class="line number8 index7 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* identically 1.</code></div><div class="line number9 index8 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* This often, but not always is the inverse of the frame rate or field rate</code></div><div class="line number10 index9 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* for video. 1/time_base is not the average frame rate if the frame rate is not</code></div><div class="line number11 index10 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* constant.</code></div><div class="line number12 index11 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*</code></div><div class="line number13 index12 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* Like containers, elementary streams also can store timestamps, 1/time_base</code></div><div class="line number14 index13 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* is the unit in which these timestamps are specified.</code></div><div class="line number15 index14 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* As example of such codec time base see ISO/IEC 14496-2:2001(E)</code></div><div class="line number16 index15 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* vop_time_increment_resolution and fixed_vop_rate</code></div><div class="line number17 index16 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* (fixed_vop_rate == 0 implies that it is different from the framerate)</code></div><div class="line number18 index17 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*</code></div><div class="line number19 index18 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* - encoding: MUST be set by user.</code></div><div class="line number20 index19 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">* - decoding: the use of this field for decoding is deprecated.</code></div><div class="line number21 index20 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Use framerate instead.</code></div><div class="line number22 index21 alt1"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c comments">*/</code></div><div class="line number23 index22 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c plain">AVRational time_base;</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="c spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="c plain">......</code></div><div class="line number26 index25 alt1"><code class="c plain">}</code></div></div></td></tr></tbody></table></div></div>

<p>上述注释指出，AVCodecContext.time_base 是帧率(视频帧)的倒数，每帧时间戳递增 1，那么 tbc 就等于帧率。编码过程中，应由用户设置好此参数。解码过程中，此参数已过时，建议直接使用帧率倒数用作时间基。</p>

<p>这里有一个问题：<strong><code>按照此处注释说明，帧率为 25 的视频流，tbc 理应为 25，但实际值却为50，不知作何解释？是否 tbc 已经过时，不具参考意义？</code></strong></p>

<p>根据注释中的建议，实际使用时，在视频解码过程中，我们不使用 AVCodecContext.time_base，而用帧率倒数作时间基，在视频编码过程中，我们将 AVCodecContext.time_base 设置为帧率的倒数。</p>

<h6 id="371">3.7.1 视频流</h6>

<p>视频按帧播放，所以解码后的原始视频帧时间基为 1/framerate。</p>

<p>视频解码过程中的时间基转换处理：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_701517"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c plain">AVFormatContext *ifmt_ctx;</code></div><div class="line number2 index1 alt1"><code class="c plain">AVStream *in_stream;</code></div><div class="line number3 index2 alt2"><code class="c plain">AVCodecContext *dec_ctx;</code></div><div class="line number4 index3 alt1"><code class="c plain">AVPacket packet;</code></div><div class="line number5 index4 alt2"><code class="c plain">AVFrame *frame;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="c comments">// 从输入文件中读取编码帧</code></div><div class="line number8 index7 alt1"><code class="c plain">av_read_frame(ifmt_ctx, &amp;packet);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="c comments">// 时间基转换</code></div><div class="line number11 index10 alt2"><code class="c color1 bold">int</code> <code class="c plain">raw_video_time_base = av_inv_q(dec_ctx-&gt;framerate);</code></div><div class="line number12 index11 alt1"><code class="c plain">av_packet_rescale_ts(packet, in_stream-&gt;time_base, raw_video_time_base);</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="c comments">// 解码</code></div><div class="line number15 index14 alt2"><code class="c plain">avcodec_send_packet(dec_ctx, packet)</code></div><div class="line number16 index15 alt1"><code class="c plain">avcodec_receive_frame(dec_ctx, frame);</code></div></div></td></tr></tbody></table></div></div>

<p>视频编码过程中的时间基转换处理：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_271413"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c plain">AVFormatContext *ofmt_ctx;</code></div><div class="line number2 index1 alt1"><code class="c plain">AVStream *out_stream;</code></div><div class="line number3 index2 alt2"><code class="c plain">AVCodecContext *dec_ctx;</code></div><div class="line number4 index3 alt1"><code class="c plain">AVCodecContext *enc_ctx;</code></div><div class="line number5 index4 alt2"><code class="c plain">AVPacket packet;</code></div><div class="line number6 index5 alt1"><code class="c plain">AVFrame *frame;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="c comments">// 编码</code></div><div class="line number9 index8 alt2"><code class="c plain">avcodec_send_frame(enc_ctx, frame);</code></div><div class="line number10 index9 alt1"><code class="c plain">avcodec_receive_packet(enc_ctx, packet);</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="c comments">// 时间基转换</code></div><div class="line number13 index12 alt2"><code class="c plain">packet.stream_index = out_stream_idx;</code></div><div class="line number14 index13 alt1"><code class="c plain">enc_ctx-&gt;time_base = av_inv_q(dec_ctx-&gt;framerate);</code></div><div class="line number15 index14 alt2"><code class="c plain">av_packet_rescale_ts(&amp;opacket, enc_ctx-&gt;time_base, out_stream-&gt;time_base);</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="c comments">// 将编码帧写入输出媒体文件</code></div><div class="line number18 index17 alt1"><code class="c plain">av_interleaved_write_frame(o_fmt_ctx, &amp;packet);</code></div></div></td></tr></tbody></table></div></div>

<h6 id="372">3.7.2 音频流</h6>

<p>音频按采样点播放，所以解码后的原始音频帧时间基为 1/sample_rate</p>

<p>音频解码过程中的时间基转换处理：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_10372"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c plain">AVFormatContext *ifmt_ctx;</code></div><div class="line number2 index1 alt1"><code class="c plain">AVStream *in_stream;</code></div><div class="line number3 index2 alt2"><code class="c plain">AVCodecContext *dec_ctx;</code></div><div class="line number4 index3 alt1"><code class="c plain">AVPacket packet;</code></div><div class="line number5 index4 alt2"><code class="c plain">AVFrame *frame;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="c comments">// 从输入文件中读取编码帧</code></div><div class="line number8 index7 alt1"><code class="c plain">av_read_frame(ifmt_ctx, &amp;packet);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="c comments">// 时间基转换</code></div><div class="line number11 index10 alt2"><code class="c color1 bold">int</code> <code class="c plain">raw_audio_time_base = av_inv_q(dec_ctx-&gt;sample_rate);</code></div><div class="line number12 index11 alt1"><code class="c plain">av_packet_rescale_ts(packet, in_stream-&gt;time_base, raw_audio_time_base);</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="c comments">// 解码</code></div><div class="line number15 index14 alt2"><code class="c plain">avcodec_send_packet(dec_ctx, packet)</code></div><div class="line number16 index15 alt1"><code class="c plain">avcodec_receive_frame(dec_ctx, frame);</code></div></div></td></tr></tbody></table></div></div>

<p>音频编码过程中的时间基转换处理：</p>

<div><div class="syntaxhighlighter  c" id="highlighter_316988"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="c plain">AVFormatContext *ofmt_ctx;</code></div><div class="line number2 index1 alt1"><code class="c plain">AVStream *out_stream;</code></div><div class="line number3 index2 alt2"><code class="c plain">AVCodecContext *dec_ctx;</code></div><div class="line number4 index3 alt1"><code class="c plain">AVCodecContext *enc_ctx;</code></div><div class="line number5 index4 alt2"><code class="c plain">AVPacket packet;</code></div><div class="line number6 index5 alt1"><code class="c plain">AVFrame *frame;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="c comments">// 编码</code></div><div class="line number9 index8 alt2"><code class="c plain">avcodec_send_frame(enc_ctx, frame);</code></div><div class="line number10 index9 alt1"><code class="c plain">avcodec_receive_packet(enc_ctx, packet);</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="c comments">// 时间基转换</code></div><div class="line number13 index12 alt2"><code class="c plain">packet.stream_index = out_stream_idx;</code></div><div class="line number14 index13 alt1"><code class="c plain">enc_ctx-&gt;time_base = av_inv_q(dec_ctx-&gt;sample_rate);</code></div><div class="line number15 index14 alt2"><code class="c plain">av_packet_rescale_ts(&amp;opacket, enc_ctx-&gt;time_base, out_stream-&gt;time_base);</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="c comments">// 将编码帧写入输出媒体文件</code></div><div class="line number18 index17 alt1"><code class="c plain">av_interleaved_write_frame(o_fmt_ctx, &amp;packet);</code></div></div></td></tr></tbody></table></div></div>

<p>参考资料：</p>

<ul>
<li><p><a href="http://ffmpeg-users.933282.n4.nabble.com/What-does-the-output-of-ffmpeg-mean-tbr-tbn-tbc-etc-td941538.html" target="_blank">What does the output of ffmpeg mean? tbr tbn tbc etc?</a></p></li>
<li><p><a href="https://www.cnblogs.com/leisure_chn/p/10285829.html" target="_blank">视频编解码基础概念</a></p></li>
<li><p><a href="https://blog.csdn.net/topsluo/article/details/76239136" target="_blank">对 FFmpeg 的时间戳的理解笔记</a></p></li>
<li><p><a href="http://www.imooc.com/article/91381" target="_blank">FFmpeg 中的时间戳与时间基</a></p></li>
<li><p><a href="http://www.52ffmpeg.com/article/353.html" target="_blank">FFmpeg 编解码中涉及到的 pts 详解</a></p></li>
<li><p><a href="https://blog.csdn.net/zhouyongku/article/details/38510747" target="_blank">音视频录入的 pts 和 dts 问题</a></p></li>
<li><p><a href="https://www.cnblogs.com/leisure_chn/p/10584910.html" target="_blank">FFmpeg 时间戳详解</a></p></li>
</ul></body></html>