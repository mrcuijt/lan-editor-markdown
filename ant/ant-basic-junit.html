<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ant-basic-junit</title>
</head>
<link rel="stylesheet" type="text/css" href="../plugin/LanEditor/LanEditor.css"/>
<link rel="stylesheet" type="text/css" href="../plugin/LanEditor/highlight/styles/idea.css">

<link href="../plugin/SyntaxHighlighter/main.css" rel='stylesheet' type='text/css'>
<link href="../plugin/SyntaxHighlighter/shCore.css" rel='stylesheet' type='text/css'>
<link href="../plugin/SyntaxHighlighter/shThemeDefault.css" rel='stylesheet' type='text/css'>
<link href="../plugin/LanEditor/main.css" rel='stylesheet' type='text/css'>

<script src="../plugin/SyntaxHighlighter/shCore-convert.js" type='text/javascript'></script>
<script src="../plugin/SyntaxHighlighter/shBrushAll.js" type='text/javascript'></script>

<script type="text/javascript" src="../plugin/LanEditor/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../plugin/autosize/autosize.bundle.js"></script>
<script type="text/javascript" src="../plugin/LanEditor/LanEditor.js"></script>

<script type="text/javascript">

    window.autosize = require("autosize");

    $(document).ready(function () {
        //初始化 @textelem:编辑区的id @showelem可以省略
        var lan = LanEditor.init({
            textelem: "editor",
            showelem: "show"
        });
        //如果初始化失败，则显示出错信息
        if(lan.status == false){
            alter(lan.message);
            return ;
        }else{
            // 默认保存LanEditor快速指南文件
            // 获取文件创建的时间
            var createTime = LanEditor.Time.GetTimestamp();
            // 文件名
            LanEditor.File.CurOpenFile.name = $(document).attr("title");
            // 创建时间
            LanEditor.File.CurOpenFile.time = createTime;
            // 保存文件
            LanEditor.File.SaveFile();
            // 渲染
            LanEditor.RenderHTML();
        }
    });
</script>
<body>
<div id="edit">
    <textarea id="editor" name="editor">
#### ant-basic-junit

#### ANT task 之Junit、JunitReport

#### 一、ANT 任务之 Junit:

&amp;#160; &amp;#160;学习 ANT 其实主要是学习 ANT 的 task，ANT 众多 task 中有一个 **`Testing Tasks`**,它下面有两个任务：**`Junit`** 和 **`JunitReport`**，主要用来进行单元测试及生成单元测试报告。

<text zoom="7.2">
╔═══════════════╤═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║ Testing Tasks │                                                                                                                                                                               ║
╟───────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╢
║ Task Name     │ Description                                                                                                                                                                   ║
╟───────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╢
║ Junit         │ Runs tests from the Junit testing framework. This task has been tested with JUnit 3.0 up to JUnit 3.7; it won't work with versions prior to JUnit 3.0.                        ║
╟───────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╢
║ JunitReport   │ Merges the individual XML files generated by the Junit task and applies a stylesheet on the resulting merged document to provide a browsable report of the testcases results. ║
╚═══════════════╧═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝
</text>

```
["Testing Tasks", ""],
["Task Name", "Description"],
["Junit", "Runs tests from the Junit testing framework. This task has been tested with JUnit 3.0 up to JUnit 3.7; it won't work with versions prior to JUnit 3.0."],
["JunitReport", "Merges the individual XML files generated by the Junit task and applies a stylesheet on the resulting merged document to provide a browsable report of the testcases results."]
```

官方网址：<a href="http://ant.apache.org/manual/index.html" target="_blank">http://ant.apache.org/manual/index.html</a>

 - <a href="http://ant.apache.org/manual/Tasks/junit.html" target="_blank">Junit</a>

 - <a href="http://ant.apache.org/manual/Tasks/junitreport.html" target="_blank">JunitReport</a>

**`<junit>`** 下面可以包含其它元素，例如：
 
　　1、**`<test>`**：运行单个 **`TestCase`**
 
　　2、**`<batchtest>`**：运行多个 **`TestCase`**
 
　　3、**`<formatter>`**：定义测试结果输出格式
 
还有很多，详细可以参考官方文档。

#### 二、项目实例

目录结构如下

![title](./images/ant-basic-junit/ant-basic-junit-001.png)

SimpleCalculation 类代码如下

```java
package com.glen.he;

public class SimpleCalculation {
    public int Add(int a,int b){        
        return (a+b);        
    }
}
```

测试类 SimpleCalculationTest 代码如下

```java
package com.glen.he;

import com.glen.he.SimpleCalculation;

import static org.junit.Assert.*;
import org.junit.Test;

public class SimpleCalculationTest {

    SimpleCalculation sc = new SimpleCalculation();

    @Test
    public void AddTest() {

        int c = sc.Add(3, 5);    

        assertEquals(8, c);        
    }
}
```

在项目要目录下添加 **`build.xml`** (执行一个测试)文件，内容如下

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project name="AntDemo" default="junit" basedir=".">
    <!-- =================================================================== -->
    <!-- 变量设置  -->
    <!-- =================================================================== -->

    <property name="src.path" value="src/java"/>
    <property name="build.path" value="build"/>
    <property name="test.path" value="src/test"/>
    <property name="lib.path" value="lib"/>         
        
    <!-- =================================================================== -->
    <!-- 设置 classpath -->
    <!-- =================================================================== -->
    <path id="compile.path">        
        <fileset dir="${lib.path}">
            <include name="**/*.jar"/>
        </fileset>

        <pathelement path="${build.path}"/>
    </path>     

    <!-- =================================================================== -->
    <!-- 清除历史编译 class -->
    <!-- =================================================================== -->
    <target name="clean" description="clean">
        <delete dir="${build.path}"/>
    </target>

    <!-- =================================================================== -->
    <!-- 编译测试文件，初始化目录 -->
    <!-- =================================================================== -->
    <target name="compile" description="compile">
        <mkdir dir="${build.path}"/>                        
        <javac srcdir="${src.path}" destdir="${build.path}"  classpathref="compile.path"/>
        <javac srcdir="${test.path}" destdir="${build.path}"  classpathref="compile.path"/>
    </target>      

    <!-- =================================================================== -->
    <!-- 执行测试案例 -->
    <!-- =================================================================== -->
    <target name="junit" depends="clean,compile">
        <junit printsummary="true">
             <classpath refid="compile.path"/>                  
             <test name="com.glen.he.SimpleCalculationTest"/>
         </junit>
     </target>

</project>
```

说明

```xml
<junit printsummary="true">
	<classpath refid="compile.path"/> 
	<test name="com.glen.he.SimpleCalculationTest"/>
</junit>

<path id="compile.path"> 
　　<fileset dir="${lib.path}">
　　　　<include name="**/*.jar"/>
　　</fileset>
　　<pathelement path="${build.path}"/>
</path>
```

&amp;#160; &amp;#160;我们在 **`<junit>`** 任务下，使用了编译后的 .class 文件的目录，还有编译所需的 jar 包所在的目录。 因为，JUnit 任务实际就是为我们运行 Test 类，而不仅仅是像我们发布 Ant 文件那样只是 javac 编译，只需要编译所需的 Jar 包。我们还需要像 java 任务那样运 .class 文件,所以必须包括编译后的 .class 文件。

然后把 build.xml 文件拖到 Ant 视图中，如下图，双击 junit 执行即可

![title](./images/ant-basic-junit/ant-basic-junit-002.png)

执行结果

```python
Buildfile: D:\AntTest\build.xml
clean:
   [delete] Deleting directory D:\AntTest\build
compile:
    [mkdir] Created dir: D:\AntTest\build  
    [javac] Compiling 1 source file to D:\AntTest\build
   
    [javac] Compiling 1 source file to D:\AntTest\build
junit:
    [junit] Running com.glen.he.SimpleCalculationTest
    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.016 sec
BUILD SUCCESSFUL
Total time: 1 second
```

#### 三、增强版 build.xml

&amp;#160; &amp;#160;通过上面第二步，基本可以达到使用 ant 和 junit 来进行单元测试，但还远远不够，比如需要批量运行案例，生成报告等，下面会介绍这些内容

 - 使用 ormatter 属性输出 junit 信息：

  - 修改 **`build.xml`** 文件，增加第 16，49，51，57，58，59 行代码

  - 修改 **`build.xml`** 文件，修改 53 行代码，增加了 **`todir`** 属性，指定 xml 的输出路径。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project name="AntDemo" default="junit" basedir=".">
    <!-- =================================================================== -->
    <!-- 变量设置  -->
    <!-- =================================================================== -->

    <property name="src.path" value="src/java"/>
    <property name="build.path" value="build"/>
    <property name="test.path" value="src/test"/>
    <property name="lib.path" value="lib"/>
    <property name="report.path" value="report"/>

    <!-- =================================================================== -->
    <!-- 设置 classpath -->
    <!-- =================================================================== -->
    <path id="compile.path">        
        <fileset dir="${lib.path}">
            <include name="**/*.jar"/>
        </fileset>
        
        <pathelement path="${build.path}"/>
    </path>     

    <!-- =================================================================== -->
    <!-- 清除历史编译 class -->
    <!-- =================================================================== -->
    <target name="clean" description="clean">
        <delete dir="${build.path}"/>
    </target>

    <!-- =================================================================== -->
    <!-- 编译测试文件，初始化目录 -->
    <!-- =================================================================== -->
    <target name="compile" description="compile">
        <mkdir dir="${build.path}"/>                        
        <javac srcdir="${src.path}" destdir="${build.path}"  classpathref="compile.path"/>
        <javac srcdir="${test.path}" destdir="${build.path}"  classpathref="compile.path"/>
    </target>      

    <!-- =================================================================== -->
    <!-- 执行测试案例 -->
    <!-- =================================================================== -->
    <target name="junit" depends="clean,compile">
        <mkdir dir="${report.path}"/>        
        <junit printsummary="true" fork="true">        
             <formatter type="xml" usefile="true"/>            
             <classpath refid="compile.path"/>                                  
             <test name="com.glen.he.SimpleCalculationTest" todir="${report.path}" fork="true"/>
         </junit>
     </target>

    <target name="delete">
        <delete dir="${report.path}"/>
    </target>

</project>
```

执行 junit 的 task 后，在项目 **`report`** 目录下生成了一个名为 **`TEST-com.glen.he.SimpleCalculationTest.xml`** 的 xml 文件。

另外：

 **`<formatter type="xml" usefile="true"/>`** 中 **`type`** 属性值还有 **`plain`**、**`brief`**

这时会输出一个文本文件，提供测试失败时的详细内容以及每个测试的运行统计。

 - 批量运行单元测试案例：
 
  - 修改 **`build.xml`** 文件，把步骤 7 中的第 53 行代码替换成下面的 58~62 行代码;

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project name="AntDemo" default="junit" basedir=".">
    <!-- =================================================================== -->
    <!-- 变量设置 -->
    <!-- =================================================================== -->

    <property name="src.path" value="src/java"/>
    <property name="build.path" value="build"/>
    <property name="test.path" value="src/test"/>
    <property name="lib.path" value="lib"/>
    <property name="report.path" value="report"/>

    <!-- =================================================================== -->
    <!-- 设置 classpath -->
    <!-- =================================================================== -->
    <path id="compile.path">
        <fileset dir="${lib.path}">
            <include name="**/*.jar"/>
        </fileset>
        <pathelement path="${build.path}"/>
    </path>

    <target name="init">
        <mkdir dir="${build.path}"/>
        <mkdir dir="${report.path}"/>
    </target>

    <!-- =================================================================== -->
    <!-- 清除历史编译 class -->
    <!-- =================================================================== -->
    <target name="clean" description="clean">
        <delete dir="${build.path}"/>
    </target>

    <!-- =================================================================== -->
    <!-- 编译测试文件，初始化目录 -->
    <!-- =================================================================== -->
    <target name="compile" depends="init" description="compile">
        <javac srcdir="${src.path}" destdir="${build.path}"  classpathref="compile.path"/>
        <javac srcdir="${test.path}" destdir="${build.path}"  classpathref="compile.path"/>
    </target>      

    <!-- =================================================================== -->
    <!-- 执行测试案例 -->
    <!-- =================================================================== -->
    <target name="junit" depends="compile">                
        <junit printsummary="true" fork="true">       
			<classpath refid="compile.path"/>

			<formatter type="xml" usefile="true"/>        

			<batchtest fork="on" todir="${report.path}" haltonfailure="no">
                <fileset dir="${build.path}">
                    <include name="**/*Test.class"/>
                </fileset>
            </batchtest>
         </junit>
     </target>

    <!-- 清除 Junit 生成的报表文档 -->
    <target name="delete">
        <delete dir="${report.path}"/>
    </target>

</project>
```

 - 使用 **`<JunitReport>`** 生成测试报告

&amp;#160; &amp;#160;在上面我们已经知道，通过 **`formatter(type="xml")`** 输出 junit 信息时会在指定目录下生成一个 **`Test-类路径名.xml`** 的 xml 文件，但是这个 xml 文件看起来很不方便。Ant 提供了 **`<junitreport>`** 任务使用 **`XSLT`** 将 xml 文件转换为 HTML 报告，该任务首先将生成的 XML 文件整合成单一的 XML 文件,然后再对他进行转换,这个整合的文件默认情况下被命名为: **`TESTS-TestSuites.xml`**.

修改上面的 **`build.xml`** 文件，增加 65~71 行，如下

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project name="AntDemo" default="junit" basedir=".">
    <!-- =================================================================== -->
    <!-- 变量设置 -->
    <!-- =================================================================== -->

    <property name="src.path" value="src/java"/>
    <property name="build.path" value="build"/>
    <property name="test.path" value="src/test"/>
    <property name="lib.path" value="lib"/>
    <property name="report.path" value="report"/>

    <!-- =================================================================== -->
    <!-- 设置 classpath -->
    <!-- =================================================================== -->
    <path id="compile.path">        
        <fileset dir="${lib.path}">
            <include name="**/*.jar"/>
        </fileset>
        <pathelement path="${build.path}"/>
    </path>     

    <target name="init">
        <mkdir dir="${build.path}"/>
        <mkdir dir="${report.path}"/>
    </target>

    <!-- =================================================================== -->
    <!-- 清除历史编译 class -->
    <!-- =================================================================== -->
    <target name="clean" description="clean">
        <delete dir="${build.path}"/>
    </target>

    <!-- =================================================================== -->
    <!-- 编译测试文件，初始化目录 -->
    <!-- =================================================================== -->
    <target name="compile" depends="init" description="compile">
        <javac srcdir="${src.path}" destdir="${build.path}"  classpathref="compile.path"/>
        <javac srcdir="${test.path}" destdir="${build.path}"  classpathref="compile.path"/>
    </target>      

    <!-- =================================================================== -->
    <!-- 执行测试案例 -->
    <!-- =================================================================== -->
    <target name="junit" depends="compile">
        <junit printsummary="true" fork="true">
            <classpath refid="compile.path"/>

            <formatter type="xml" usefile="true"/>        

            <batchtest fork="on" todir="${report.path}" haltonfailure="no">
                <fileset dir="${build.path}">
                    <include name="**/*Test.class"/>
                </fileset>
            </batchtest>
         </junit>

        <!-- 产生单元测试报表文档 -->
        <junitreport todir="${report.path}">
            <fileset dir="${report.path}">
                <include name="TEST-*.xml" />
            </fileset>
            <report format="frames" todir="${report.path}" />
        </junitreport>
     </target>

    <!-- 清除 Junit 生成的报表文档 -->
    <target name="delete">
        <delete dir="${report.path}"/>
    </target>

</project>
```

执行后会在指定目录下生成报告文档，打开 **`index.html`** 可以很方便的看到执行的结果。

如下图所示（我又补充了3个案例，并且故意让两个案例失败），显示执行的统计结果

![title](./images/ant-basic-junit/ant-basic-junit-003.png)

点击 **`classes`** 下面的 **`ComplexCalculationTest`**，可以看到具体某个类里面的单元测试案例执行统计情况以及失败案例的错误信息提示。

![title](./images/ant-basic-junit/ant-basic-junit-004.png)

参考连接：

 - <a href="https://www.cnblogs.com/puresoul/p/4201565.html" target="_blank">ANT task 之Junit、JunitReport</a>

 - <a href="http://blog.csdn.net/shendl/article/details/532587" target="_blank">用 Ant 自动测试 JUnit(Ant 测试自动化--上)</a>

 - <a href="http://blog.csdn.net/tochal/article/details/12560151" target="_blank">使用 Ant 进行 Junit 测试</a>
	</textarea>
</div>

<div id="show"></div>
</body>
</html>